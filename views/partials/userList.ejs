<ul style="list-style-type: none; overflow: hidden; padding-top: 30px;">

    <% users.forEach(user=>{ %>
        <il class="col-md-4" style="float: left; padding-bottom: 15px; padding-right: 15px;">
            <%- include('./user', {user: user, withPassword: withPassword}); %>
        </il>
        <% }); %>
</ul>
<button class="btn btn-warning" data-toggle="modal" data-target="#addCustomerModal">Add Customer</button>

<button class="btn btn-warning" onclick="$('#main').load('users');">Refresh Page</button>

<div id="addCustomerModal" class="modal fade">
    <div class="modal-dialog modal-login">
        <div class="modal-content">
            <form action="javascript:void(0);">
                <div class="modal-header">
                    <h4 class="modal-title">Add Customer</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>First Name</label>
                        <input type="text" id="fnameAddCustomer" class="form-control" required="required" />
                        <label>Last Name</label>
                        <input type="text" id="lnameAddCustomer" class="form-control" required="required" />
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="text" id="emailAddCustomer" class="form-control" required="required" />
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input id="passwordAddCustomer" type="password" class="form-control" required="required" />
                    </div>
                    <div class="form-group">
                        <label>Confirm Password</label>
                        <input id="passwordAddCustomerConfirm" type="password" class="form-control" required="required" />
                    </div>
                </div>
                <div class="modal-footer justify-content-between">
                    <button class="btn btn-warning" onclick="createCustomer()">
                        Create
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<div id="deleteUserModal" class="modal fade">
    <div class="modal-dialog modal-login">
        <div class="modal-content">
            <form action="javascript:void(0);">
                <div class="modal-header">
                    <h4 class="modal-title">Delete User</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                </div>
                <div class="modal-body" id="deleteUserBody">
                </div>
                <div class="modal-footer justify-content-between">
                    <button class="btn btn-warning" id="confirmDelete">
                    Yes
                </button>
                    <button class="btn btn-warning" data-dismiss="modal">
                    No
                </button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    async function createCustomer() {
        let password = $(passwordAddCustomer).val();
        if (password != $(passwordAddCustomerConfirm).val()) {
            return;
        }
        let fname = $(fnameAddCustomer).val();
        let lname = $(lnameAddCustomer).val();
        let email = $(emailAddCustomer).val();
        fetch("/createCustomer", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    email: email,
                    password: password,
                    fname: fname,
                    lname: lname,
                }),
            })
            .then((res) => res.json())
            .then((data) => {
                if (data.success) {
                    $("#addCustomerModal").modal("toggle");
                    $(".form-group input").val('');
                }

            })
            .catch((error) => {
                console.error("Failed to connect to server");
            });
    }

    async function deleteUser(event) {
        fetch("/deleteUser", {
                method: "DELETE",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    email: event.data.email,
                }),
            })
            .then((res) => res.json())
            .then((data) => {
                if (data.success) {
                    $("#deleteUserModal").modal("toggle");
                }

            })
            .catch((error) => {
                console.error("Failed to connect to server");
            });
    }

    function prepareDelete(name, email) {
        $('#deleteUserBody').text(`Are you sure you want to delete ${name}?`);
        $("#confirmDelete").bind('click', {
            email: email
        }, deleteUser);
    }
</script>