<ul style="list-style-type: none; overflow: hidden; padding-top: 30px;">

    <% users.forEach(user=>{ %>
        <il class="col-md-4" style="float: left; padding-bottom: 15px; padding-right: 15px;">
            <%- include('./user', {user: user, withPassword: withPassword}); %>
        </il>
        <% }); %>
</ul>
<div style="margin-bottom: 10px;">
    <button class="btn btn-warning" data-toggle="modal" data-target="#addCustomerModal">Add Customer</button>
    <% if(withPassword){%>
        <button class="btn btn-warning" data-toggle="modal" data-target="#addEmployeeModal">Add Employee</button>
        <%}%>
            <button class="btn btn-warning" onclick="mainLoad('users');">Refresh Page</button>
</div>

<div id="deleteUserModal" class="modal fade">
    <div class="modal-dialog modal-login">
        <div class="modal-content">
            <form action="javascript:void(0);">
                <div class="modal-header">
                    <h4 class="modal-title">Delete User</h4>
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                </div>
                <div class="modal-body" id="deleteUserBody">
                </div>
                <div class="modal-footer justify-content-between">
                    <button class="btn btn-warning" id="confirmDelete">
                    Yes
                </button>
                    <button class="btn btn-warning" data-dismiss="modal">
                    No
                </button>
                </div>
            </form>
        </div>
    </div>
</div>
<% if(withPassword){%>

    <div id="promoteModal" class="modal fade">
        <div class="modal-dialog modal-login">
            <div class="modal-content">
                <form action="javascript:void(0);">
                    <div class="modal-header">
                        <h4 class="modal-title">Promote to manager</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                    </div>
                    <div class="modal-body" id="promoteBody">
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button class="btn btn-warning" id="confirmPromote">
                    Yes
                </button>
                        <button class="btn btn-warning" data-dismiss="modal">
                    No
                </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div id="addEmployeeModal" class="modal fade">
        <div class="modal-dialog modal-login">
            <div class="modal-content">
                <form action="javascript:void(0);">
                    <div class="modal-header">
                        <h4 class="modal-title">New Employee</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                &times;
                            </button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>First Name</label>
                            <input type="text" id="fnameAddEmployee" class="form-control" required="required" />
                            <label>Last Name</label>
                            <input type="text" id="lnameAddEmployee" class="form-control" required="required" />
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="text" id="emailAddEmployee" class="form-control" required="required" />
                        </div>
                        <div class="form-group">
                            <label>Password</label>
                            <input id="passwordAddEmployee" type="password" class="form-control" required="required" />
                        </div>
                        <div class="form-group">
                            <label>Confirm Password</label>
                            <input id="passwordAddEmployeeConfirm" type="password" class="form-control" required="required" />
                        </div>
                        <div class="form-group">
                            <label>Salary</label>
                            <input id="salaryAddEmployee" type="number" class="form-control" required="required" step="0.01" min="0" />
                        </div>
                        <div class="form-group">
                            <label>Branch ID</label>
                            <input id="branchAddEmployee" type="number" class="form-control" required="required" />
                        </div>
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button class="btn btn-warning" onclick="createEmployee()">
                                Create
                            </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <%}%>
        <script>
            async function deleteUser(event) {
                loading(true);
                fetch("/deleteUser", {
                        method: "DELETE",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            email: event.data.email,
                        }),
                    })
                    .then((res) => res.json())
                    .then((data) => {
                        loading(false);
                        if (data.success) {
                            $("#deleteUserModal").modal("toggle");
                        }
                    })
                    .catch((error) => {
                        console.error("Failed to connect to server");
                    });
            }

            function prepareDelete(name, email) {
                $('#deleteUserBody').text(`Are you sure you want to delete ${name}?`);
                $("#confirmDelete").bind('click', {
                    email: email
                }, deleteUser);
            }
            async function promoteUser(event) {
                loading(true);
                fetch("/promoteUser", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            email: event.data.email,
                        }),
                    })
                    .then((res) => res.json())
                    .then((data) => {
                        loading(false);
                        if (data.success) {
                            $("#promoteModal").modal("toggle");
                        }
                    })
                    .catch((error) => {
                        console.error("Failed to connect to server");
                    });
            }

            function preparePromote(name, email) {
                $('#promoteBody').text(`Are you sure you want to promote ${name}?`);
                $("#confirmPromote").bind('click', {
                    email: email
                }, promoteUser);
            }
            async function createEmployee() {
                let password = $(passwordAddEmployee).val();
                if (password != $(passwordAddEmployeeConfirm).val()) {
                    return;
                }
                let fname = $(fnameAddEmployee).val();
                let lname = $(lnameAddEmployee).val();
                let email = $(emailAddEmployee).val();
                let salary = $(salaryAddEmployee).val();
                let branch = $(branchAddEmployee).val();
                loading(true);
                fetch("/createEmployee", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            email: email,
                            password: password,
                            fname: fname,
                            lname: lname,
                            salary: salary,
                            branch: branch
                        }),
                    })
                    .then((res) => res.json())
                    .then((data) => {
                        loading(false);
                        if (data.success) {
                            $("#addEmployeeModal").modal("toggle");
                            $(".form-group input").val('');

                        }

                    })
                    .catch((error) => {
                        console.error("Failed to connect to server");
                    });
            }
        </script>